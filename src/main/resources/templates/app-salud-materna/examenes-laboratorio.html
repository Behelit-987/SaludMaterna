<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exámenes de Laboratorio - Salud Materna</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .sidenav {
            height: 100%;
            width: 250px;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #f8f9fa;
            overflow-x: hidden;
            padding-top: 20px;
            border-right: 1px solid #dee2e6;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        
        .nav-link {
            color: #333;
            padding: 10px 20px;
            text-decoration: none;
            display: block;
            transition: 0.3s;
        }
        
        .nav-link:hover {
            background-color: #e9ecef;
            color: #0d6efd;
        }
        
        .examen-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .conditional-field {
            display: none;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .radio-label input[type="radio"] {
            display: none;
        }
        
        .radio-label span {
            padding-left: 8px;
        }
        
        .radio-label:has(input[value="si"]):hover {
            background-color: rgba(34, 197, 94, 0.1);
        }
        
        .radio-label:has(input[value="no"]):hover {
            background-color: rgba(239, 68, 68, 0.1);
        }
        
        .radio-label.active-si {
            background-color: #22c55e;
            color: white;
        }
        
        .radio-label.active-no {
            background-color: #ef4444;
            color: white;
        }
        
        .required-field::after {
            content: " *";
            color: #ef4444;
        }
        
        .user-info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 2rem;
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidenav">
    	
    	<div class="user-info">
            <div class="user-avatar">
                <i class="fas fa-user-md"></i>
            </div>
            <div class="user-name">
                <div class="text-sm text-gray-600 mt-2" th:if="${usuaria}">
                <a href="/conocimiento-general" th:text="${usuaria?.nombreCompleto ?: 'Usuario'}"></a>
            </div>
                <small>Salud Materna</small>
            </div>
        </div>
    	<!--  
        <div class="px-4 py-4">
            <h2 class="text-xl font-bold text-blue-600">Salud Materna</h2>
        </div>
        -->
        
        <nav>
            <a href="/app-salud-materna" class="nav-link">
                <i class="fas fa-home"></i> Inicio
            </a>
            <a href="/app-salud-materna/citas" class="nav-link active">
                <i class="fas fa-calendar-alt"></i>
                <span>Recomendación de Citas para tu embarazo</span>
            </a>
            <a href="/app-salud-materna/educacion-materna" class="nav-link">
                <i class="fas fa-book"></i> Educación Materna
            </a>
            <a href="/app-salud-materna/examenes-laboratorio" class="nav-link">
                <i class="fas fa-heartbeat"></i> Exámenes de Laboratorio
            </a>
            <a href="/reporte-citas" class="nav-link">
                <i class="fas fa-chart-line"></i> Reportes de Citas
            </a>

            <a th:href="@{/logout}" class="nav-link mt-8 text-red-600">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">
                <i class="fas fa-flask text-blue-600 mr-2"></i>
                Exámenes de Laboratorio
            </h1>
            <div class="text-sm text-gray-600">
                <span class="font-semibold">Paciente:</span> 
                <span th:text="${usuaria?.nombreCompleto ?: 'Nombre no disponible'}"></span>
            </div>
        </div>

        <!-- Mensajes -->
        <div th:if="${success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
            <i class="fas fa-check-circle mr-2"></i>
            <span th:text="${success}"></span>
        </div>
        
        <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <i class="fas fa-exclamation-circle mr-2"></i>
            <span th:text="${error}"></span>
        </div>
        
        <div style="display: none;">
		    <p th:text="'Glucosa: ' + ${examenes?.glucosaAyuno}"></p>
		    <p th:text="'Fecha: ' + ${examenes?.fechaGlucosa}"></p>
		    <p th:text="'Resultado: ' + ${examenes?.resultadoGlucosa}"></p>
		</div>
        
        <!-- Formulario de Exámenes -->
        <form th:action="@{/app-salud-materna/examenes-laboratorio/guardar}" th:object="${examenes}" method="post" id="examenesForm">
            <input type="hidden" name="idUsuaria" th:value="${usuaria?.idUser}">
            <input type="hidden" th:if="${examenes?.idExamenes}" th:field="*{idExamenes}">
    		<input type="hidden" name="idUsuaria" th:value="${usuaria?.idUser}">
            
            <!-- Glucosa en Ayunas -->
<div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">Glucosa en Ayunas</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="glucosaLabelSi">
                <input type="radio" name="glucosaAyuno" value="si" 
                       th:checked="${examenes?.glucosaAyuno?.toString() == 'si'}"
                       onchange="toggleExamenFields('glucosa', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="glucosaLabelNo">
                <input type="radio" name="glucosaAyuno" value="no" 
                       th:checked="${examenes?.glucosaAyuno == null or examenes?.glucosaAyuno?.toString() == 'no'}"
                       onchange="toggleExamenFields('glucosa', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="glucosaFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaGlucosa" 
                       th:value="${#temporals.format(examenes?.fechaGlucosa, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoGlucosa" 
                       th:value="${examenes?.resultadoGlucosa}"
                       placeholder="Ej: 85 mg/dL"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>

            <!-- Biometría Hemática -->
            <div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">Biometría Hemática</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="biometricaLabelSi">
                <input type="radio" name="biometricaHematica" value="si" 
                       th:checked="${examenes?.biometricaHematica?.toString() == 'si'}"
                       onchange="toggleExamenFields('biometrica', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="biometricaLabelNo">
                <input type="radio" name="biometricaHematica" value="no" 
                       th:checked="${examenes?.biometricaHematica == null or examenes?.biometricaHematica?.toString() == 'no'}"
                       onchange="toggleExamenFields('biometrica', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="biometricaFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaBiometrica" 
                       th:value="${#temporals.format(examenes?.fechaBiometrica, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoBiometrica" 
                       th:value="${examenes?.resultadoBiometrica}"
                       placeholder="Ej: 85 mg/dL"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>

            <!-- EGO (Examen General de Orina) -->
<div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">Examen General de Orina (EGO)</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="egoLabelSi">
                <input type="radio" name="ego" value="si" 
                       th:checked="${examenes?.ego?.toString() == 'si'}"
                       onchange="toggleExamenFields('ego', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="egoLabelNo">
                <input type="radio" name="ego" value="no" 
                       th:checked="${examenes?.ego == null or examenes?.ego?.toString() == 'no'}"
                       onchange="toggleExamenFields('ego', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="egoFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaEgo" 
                       th:value="${#temporals.format(examenes?.fechaEgo, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoEgo" 
                       th:value="${examenes?.resultadoEgo}"
                       placeholder="Ej: Normal, sin alteraciones"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>

            <!-- Urocultivo -->
<div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">Urocultivo</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="urocultivoLabelSi">
                <input type="radio" name="urocultivo" value="si" 
                       th:checked="${examenes?.urocultivo?.toString() == 'si'}"
                       onchange="toggleExamenFields('urocultivo', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="urocultivoLabelNo">
                <input type="radio" name="urocultivo" value="no" 
                       th:checked="${examenes?.urocultivo == null or examenes?.urocultivo?.toString() == 'no'}"
                       onchange="toggleExamenFields('urocultivo', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="urocultivoFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaUrocultivo" 
                       th:value="${#temporals.format(examenes?.fechaUrocultivo, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoUrocultivo" 
                       th:value="${examenes?.resultadoUrocultivo}"
                       placeholder="Ej: Negativo para bacterias"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>


            <!-- VDRL (Sífilis) -->
<div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">VDRL (Sífilis)</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="vdrlLabelSi">
                <input type="radio" name="vdrl" value="si" 
                       th:checked="${examenes?.vdrl?.toString() == 'si'}"
                       onchange="toggleExamenFields('vdrl', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="vdrlLabelNo">
                <input type="radio" name="vdrl" value="no" 
                       th:checked="${examenes?.vdrl == null or examenes?.vdrl?.toString() == 'no'}"
                       onchange="toggleExamenFields('vdrl', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="egoFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaVdrl" 
                       th:value="${#temporals.format(examenes?.fechaVdrl, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoVdrl" 
                       th:value="${examenes?.resultadoVdrl}"
                       placeholder="Ej: No reactivo"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>

            <!-- VIH y Hepatitis B -->
   <div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">Detección de VIH y Hepatitis B</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="vihLabelSi">
                <input type="radio" name="vihHepatitisB" value="si" 
                       th:checked="${examenes?.vihHepatitisB?.toString() == 'si'}"
                       onchange="toggleExamenFields('vih', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="vihLabelNo">
                <input type="radio" name="vihHepatitisB" value="no" 
                       th:checked="${examenes?.vihHepatitisB == null or examenes?.vihHepatitisB?.toString() == 'no'}"
                       onchange="toggleExamenFields('vdrl', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="egoFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaVih" 
                       th:value="${#temporals.format(examenes?.fechaVih, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoVih" 
                       th:value="${examenes?.resultadoVih}"
                       placeholder="Ej: Negativo para VIH y Hepatitis B"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>

<div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">Creatinina</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="creatininaLabelSi">
                <input type="radio" name="creatinina" value="si" 
                       th:checked="${examenes?.creatinina?.toString() == 'si'}"
                       onchange="toggleExamenFields('creatinina', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="creatininaLabelNo">
                <input type="radio" name="creatinina" value="no" 
                       th:checked="${examenes?.creatinina == null or examenes?.creatinina?.toString() == 'no'}"
                       onchange="toggleExamenFields('vdrl', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="creatininaFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaCreatinina" 
                       th:value="${#temporals.format(examenes?.fechaCreatinina, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoCreatinina" 
                       th:value="${examenes?.resultadoCreatinina}"
                       placeholder="Ej: 0.5-1.1 mg/dL"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>

<div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">Acido Urico</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="acidoLabelSi">
                <input type="radio" name="acidoUrico" value="si" 
                       th:checked="${examenes?.acidoUrico?.toString() == 'si'}"
                       onchange="toggleExamenFields('acido', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="acidoLabelNo">
                <input type="radio" name="acidoUrico" value="no" 
                       th:checked="${examenes?.acidoUrico == null or examenes?.acidoUrico?.toString() == 'no'}"
                       onchange="toggleExamenFields('acido', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="acidoFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaAcido" 
                       th:value="${#temporals.format(examenes?.fechaAcido, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoAcido" 
                       th:value="${examenes?.resultadoAcido}"
                       placeholder="Ej: 3.0-7.1 mg/dL"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>

<div class="examen-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-vial text-blue-600 text-lg mr-3"></i>
        <h3 class="text-lg font-semibold text-gray-800">Citologia Cervicovaginal</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-gray-700 mb-2 required-field">¿Se realizó este examen?</label>
        <div class="radio-group">
            <label class="radio-label" id="citologiaLabelSi">
                <input type="radio" name="citologiaCervicovaginal" value="si" 
                       th:checked="${examenes?.citologiaCervicovaginal?.toString() == 'si'}"
                       onchange="toggleExamenFields('citologia', true)">
                <i class="fas fa-check"></i>
                <span>Sí</span>
            </label>
            <label class="radio-label" id="citologiaLabelNo">
                <input type="radio" name="citologiaCervicovaginal" value="no" 
                       th:checked="${examenes?.citologiaCervicovaginal == null or examenes?.citologiaCervicovaginal?.toString() == 'no'}"
                       onchange="toggleExamenFields('citologia', false)">
                <i class="fas fa-times"></i>
                <span>No</span>
            </label>
        </div>
    </div>
    
    <div id="citologiaFields" class="conditional-field">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 mb-2 required-field">Fecha del examen</label>
                <input type="date" name="fechaCitologia" 
                       th:value="${#temporals.format(examenes?.fechaCitologia, 'yyyy-MM-dd')}"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-gray-700 mb-2 required-field">Resultado</label>
                <input type="text" name="resultadoCitologia" 
                       th:value="${examenes?.resultadoCitologia}"
                       placeholder="Ej: Negativo o Sin cambios malignos"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
    </div>
</div>


            <!-- Botones de acción -->
            <div class="flex justify-between mt-8">
                <button type="button" onclick="window.history.back()" 
                        class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition duration-300">
                    <i class="fas fa-arrow-left mr-2"></i>Volver
                </button>
                
                <div class="flex gap-4">
                    <button type="button" onclick="limpiarFormulario()" 
                            class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition duration-300">
                        <i class="fas fa-eraser mr-2"></i>Limpiar
                    </button>
                    
                    <button type="submit" 
                            class="px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300">
                        <i class="fas fa-save mr-2"></i>Guardar Exámenes
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script>
    // Función para mostrar/ocultar campos de exámenes
    function toggleExamenFields(examen, mostrar) {
        const fields = document.getElementById(examen + 'Fields');
        const labelSi = document.getElementById(examen + 'LabelSi');
        const labelNo = document.getElementById(examen + 'LabelNo');
        
        // Remover clases activas
        if (labelSi) labelSi.classList.remove('active-si');
        if (labelNo) labelNo.classList.remove('active-no');
        
        // Aplicar clases activas
        if (mostrar) {
            if (fields) fields.style.display = 'block';
            if (labelSi) labelSi.classList.add('active-si');
            
            // Hacer campos requeridos
            if (fields) {
                const inputs = fields.querySelectorAll('input');
                inputs.forEach(input => {
                    input.required = true;
                });
            }
        } else {
            if (fields) fields.style.display = 'none';
            if (labelNo) labelNo.classList.add('active-no');
            
            // Quitar requeridos y limpiar valores
            if (fields) {
                const inputs = fields.querySelectorAll('input');
                inputs.forEach(input => {
                    input.required = false;
                });
            }
        }
    }
    
    // Función para inicializar campos basado en los datos existentes
    function inicializarCampos() {
        const examenes = [
            { id: 'glucosa', name: 'glucosaAyuno' },
            { id: 'biometrica', name: 'biometricaHematica' },
            { id: 'ego', name: 'ego' },
            { id: 'urocultivo', name: 'urocultivo' },
            { id: 'vdrl', name: 'vdrl' },
            { id: 'vih', name: 'vihHepatitisB' },
            { id: 'creatinina', name: 'creatinina'},
            { id: 'acido', name: 'acidoUrico'},
            { id: 'citologia', name: 'citologiaCervicovaginal'}
        ];
        
        examenes.forEach(examen => {
            const radioSi = document.querySelector(`input[name="${examen.name}"][value="si"]`);
            const radioNo = document.querySelector(`input[name="${examen.name}"][value="no"]`);
            
            if (radioSi && radioSi.checked) {
                toggleExamenFields(examen.id, true);
            } else if (radioNo && radioNo.checked) {
                toggleExamenFields(examen.id, false);
            } else {
                // Si ninguno está seleccionado, seleccionar "no" por defecto
                if (radioNo) {
                    radioNo.checked = true;
                    toggleExamenFields(examen.id, false);
                }
            }
        });
    }
    
    // Función para limpiar todo el formulario
    function limpiarFormulario() {
        Swal.fire({
            title: '¿Limpiar formulario?',
            text: 'Se borrarán todos los datos ingresados',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, limpiar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                // Resetear formulario
                document.getElementById('examenesForm').reset();
                
                // Ocultar todos los campos condicionales
                const examenes = ['glucosa', 'biometrica', 'ego', 'urocultivo', 'vdrl', 'vih'];
                examenes.forEach(examen => {
                    toggleExamenFields(examen, false);
                });
                
                Swal.fire('¡Limpiado!', 'El formulario ha sido limpiado.', 'success');
            }
        });
    }
    
    // Inicializar cuando la página cargue
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Inicializando campos de exámenes...');
        
        // Inicializar campos según datos existentes
        inicializarCampos();
        
        // Agregar validación de fechas
        const dateInputs = document.querySelectorAll('input[type="date"]');
        const today = new Date().toISOString().split('T')[0];
        
        dateInputs.forEach(input => {
            input.max = today; // No permitir fechas futuras
            
            input.addEventListener('change', function() {
                const selectedDate = new Date(this.value);
                const maxDate = new Date(today);
                
                if (selectedDate > maxDate) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Fecha inválida',
                        text: 'No se puede seleccionar una fecha futura',
                    });
                    this.value = '';
                }
            });
        });
        
        // Agregar evento change a todos los radio buttons
        const radios = document.querySelectorAll('input[type="radio"]');
        radios.forEach(radio => {
            radio.addEventListener('change', function() {
                const examenId = getExamenId(this.name);
                const mostrar = this.value === 'si';
                toggleExamenFields(examenId, mostrar);
            });
        });
    });
    
    // Función auxiliar para obtener el ID del examen
    function getExamenId(fieldName) {
        const map = {
            'glucosaAyuno': 'glucosa',
            'biometricaHematica': 'biometrica',
            'ego': 'ego',
            'urocultivo': 'urocultivo',
            'vdrl': 'vdrl',
            'vihHepatitisB': 'vih',
            'creatinina': 'creatinina',
            'acidoUrico': 'acido',
            'citologiaCervicovaginal': 'citologia' 
        };
        return map[fieldName] || fieldName;
    }
    
    // Validación antes de enviar
    document.getElementById('examenesForm').addEventListener('submit', function(e) {
        let isValid = true;
        let mensajeError = '';
        
        // Verificar que si se seleccionó "Sí", los campos estén completos
        const radiosSi = document.querySelectorAll('input[type="radio"][value="si"]:checked');
        
        radiosSi.forEach(radio => {
            const examenId = getExamenId(radio.name);
            const fields = document.getElementById(examenId + 'Fields');
            
            if (fields && fields.style.display === 'block') {
                const inputs = fields.querySelectorAll('input[type="date"], input[type="text"]');
                inputs.forEach(input => {
                    if (!input.value.trim()) {
                        isValid = false;
                        mensajeError = `Complete todos los campos para ${getExamenNombre(radio.name)}`;
                    }
                });
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            Swal.fire({
                icon: 'error',
                title: 'Error en el formulario',
                text: mensajeError,
            });
        } else {
            Swal.fire({
                title: '¿Guardar exámenes?',
                text: 'Se guardarán los datos de los exámenes de laboratorio',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, guardar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Si se confirma, enviar el formulario
                    this.submit();
                } else {
                    e.preventDefault();
                }
            });
            e.preventDefault(); // Prevenir envío normal
        }
    });
    
    // Funciones auxiliares
    function getExamenNombre(fieldName) {
        const map = {
            'glucosaAyuno': 'Glucosa en Ayunas',
            'biometricaHematica': 'Biometría Hemática',
            'ego': 'EGO',
            'urocultivo': 'Urocultivo',
            'vdrl': 'VDRL',
            'vihHepatitisB': 'Detección de VIH y Hepatitis B',
            'creatinina' : 'Creatinina',
            'acidoUrico': 'Acido Urico',
            'citologiaCervicovaginal': 'Citologia Cervicovaginal'
        };
        return map[fieldName] || fieldName;
    }
</script>
</body>
</html>